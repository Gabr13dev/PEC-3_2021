<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Votação PEC 3/2021</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 text-gray-900 min-h-screen flex flex-col">

  <!-- Callout -->
  <div class="flex-1">

    <div class="max-w-6xl mx-auto px-4 py-8">
      <!-- Header -->
      <div class="mb-6 text-center md:text-left">
        <h1 class="text-2xl font-bold">Votação – PEC 3/2021</h1>
        <p class="text-sm text-gray-600">Também conhecida como <span class="font-medium">PEC das Prerrogativas</span> ou
          <span class="font-medium">PEC da Impunidade</span> popularmente
        </p>
      </div>

      <div class="bg-white rounded-lg shadow p-4 mb-6">
        <div class="py-2">
          <details class="group">
            <summary class="flex cursor-pointer list-none items-center justify-between font-medium">
              <span> Veja mais informações sobre a PEC</span>
              <span class="transition group-open:rotate-180">
                <svg fill="none" height="24" shape-rendering="geometricPrecision" stroke="currentColor"
                  stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="24">
                  <path d="M6 9l6 6 6-6"></path>
                </svg>
              </span>
            </summary>
            <br>
            <hr>
            <br>
            <div class="group-open:animate-fadeIn mt-3 text-neutral-600">
              <h2 class="text-xl font-bold mb-4">Informações sobre a PEC 3/2021 e Transparência</h2>
              <div class="space-y-4 text-sm leading-relaxed">
                <div class="p-3 border rounded-lg bg-gray-50">
                  <div class="flex items-center gap-2 mb-2">
                    <span class="text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded-full">Resumo gerado por IA</span>
                  </div>
                  <p><b>Resumo da PEC:</b> <br>Ela aumenta a proteção legal de deputados e senadores. <br>Só podem ser
                    presos em
                    flagrante de crime grave. <br><mark>Para serem processados, precisa de autorização da própria Casa
                      (Câmara
                      ou Senado), em votação secreta.</mark> <br>Se a autorização não for dada, o prazo do crime fica
                    congelado
                    até o fim do mandato. <br>Também dá foro privilegiado no STF a presidentes nacionais de partidos.
                    <br><u>Na
                      prática, deixa mais difícil processar políticos durante o mandato.</u></p>
                </div>

                <div class="p-3 border rounded-lg bg-gray-50">
                  <p><b>Sobre a PEC 3/2021:</b> oficialmente chamada de <b class="not-important">PEC das
                      Prerrogativas</b>,
                    apelidada de <b class="not-important">PEC da Blindagem</b>, e popularmente conhecida como <b
                      class="very-important">PEC da Impunidade</b> nas redes sociais e outras mídias.</p>
                </div>

                <div class="p-3 border rounded-lg bg-gray-50">
                  <p><b>Fonte dos dados:</b> Todos os dados foram consultados diretamente da API oficial da Câmara
                    disponível em
                    <a href="https://dadosabertos.camara.leg.br/api/v2" target="_blank"
                      class="underline text-indigo-600">https://dadosabertos.camara.leg.br/api/v2</a>. e salvos em cache
                    para
                    melhor perfomace
                  </p>
                </div>

                <div class="p-3 border rounded-lg bg-gray-50">
                  <p><b>Lei de Acesso à Informação (Lei 12.527/2011):</b> garante que qualquer cidadão tenha acesso a
                    informações públicas. O voto dos parlamentares é dado em função do cargo e, portanto, é <b>ato
                      público</b>.
                    Por isso, divulgar como cada deputado votou não é crime — é um dever de transparência previsto na
                    Constituição.</p>
                </div>
              </div>
            </div>
          </details>
        </div>
      </div>

      <!-- Filtros -->
      <div class="bg-white rounded-lg shadow p-4 mb-6">
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
          <input id="search" type="text" placeholder="Buscar deputado..."
            class="rounded-lg border px-3 py-2 focus:ring-2 focus:ring-indigo-500 w-full" />
          <select id="partyFilter" class="rounded-lg border px-3 py-2 w-full">
            <option value="">Todos os partidos</option>
          </select>
          <select id="voteFilter" class="rounded-lg border px-3 py-2 w-full">
            <option value="">Todos os votos</option>
          </select>
        </div>
      </div>

      <!-- Tabela no desktop -->
      <table class="min-w-full text-sm md:table">
        <thead class="bg-indigo-200 text-gray-700 text-xs uppercase">
          <tr>
            <th class="px-4 py-2 text-left">Deputado</th>
            <th class="px-4 py-2 text-left">Partido</th>
            <th class="px-4 py-2 text-left">Voto</th>
          </tr>
        </thead>
        <tbody id="tableBody"></tbody>
      </table>

      <!-- Estado vazio -->
      <div id="emptyState" class="hidden p-4 text-center text-gray-500">Nenhum resultado.</div>
    </div>
  </div>


  <footer id="footer" class="bg-indigo-800 w-full py-6 px-4 h-32 bottom-0 inset-x-0 bottom-0 mt-12">
    <div class="text-center text-white">
      <p>Desenvolvido por <a href="https://github.com/Gabr13dev">Gabriel de Almeida</a></p>
      <p>2025 &copy; Todos direitos reservados</p>
    </div>
  </footer>

  <script>
    const API = "./votos.xml";
    const $ = sel => document.querySelector(sel);

    const tableBody = $("#tableBody");
    const searchInput = $("#search");
    const partyFilter = $("#partyFilter");
    const voteFilter = $("#voteFilter");
    const emptyState = $("#emptyState");

    let rawData = [];

    function voteClass(v) {
      const norm = v.toUpperCase();
      if (norm === "SIM") return "text-red-600 font-bold";
      if (norm === "NÃO" || norm === "NAO") return "text-green-600 font-bold";
      return "text-gray-700";
    }

    function renderTable(rows) {
      tableBody.innerHTML = "";
      if (!rows.length) {
        emptyState.classList.remove("hidden");
        return;
      }
      emptyState.classList.add("hidden");
      rows.forEach(r => {
        const tr = document.createElement("tr");
        tr.className = "border-b last:border-0 hover:bg-gray-50";

        tr.innerHTML = `
          <td class="px-4 py-2">
            <div class="flex items-center gap-3">
              <img src="${r.foto}" class="h-10 w-10 rounded-full object-cover bg-gray-200" />
              <span>${r.nome}</span>
            </div>
          </td>
          <td class="px-4 py-2">${r.partido}</td>
          <td class="px-4 py-2"><span class="${voteClass(r.voto)}">${r.voto}</span></td>
        `;
        tableBody.appendChild(tr);
      });
    }

    function renderCards(rows) {
      const cardsBody = document.getElementById("cardsBody");
      cardsBody.innerHTML = "";

      rows.forEach(r => {
        const card = document.createElement("div");
        card.className = "flex items-center gap-3 p-3 border rounded-lg shadow-sm bg-white";

        card.innerHTML = `
      <img src="${r.foto}" class="h-12 w-12 rounded-full object-cover" />
      <div class="flex-1">
        <p class="font-semibold text-gray-900">${r.nome}</p>
        <p class="text-xs text-gray-500">${r.partido}</p>
      </div>
      <span class="${voteClass(r.voto)} text-sm">${r.voto}</span>
    `;
        cardsBody.appendChild(card);
      });
    }


    function applyFilters() {
      const q = searchInput.value.toLowerCase();
      const p = partyFilter.value;
      const v = voteFilter.value;
      const filtered = rawData.filter(r => {
        const matchName = r.nome.toLowerCase().includes(q);
        const matchParty = !p || r.partido === p;
        const matchVote = !v || r.voto === v;
        return matchName && matchParty && matchVote;
      });
      renderTable(filtered);

    }

    async function load() {
      try {
        const resp = await fetch(API, { headers: { "Accept": "application/xml" } });
        const xmlText = await resp.text();
        const parser = new DOMParser();
        const xmlDoc = parser.parseFromString(xmlText, "application/xml");

        const votos = xmlDoc.getElementsByTagName("voto_");
        const partidos = new Set();
        const tiposVoto = new Set();

        rawData = Array.from(votos).map(v => {
          const nome = v.getElementsByTagName("nome")[0]?.textContent || "";
          const partido = v.getElementsByTagName("siglaPartido")[0]?.textContent || "";
          const foto = "./fotos/" + v.getElementsByTagName("id")[0]?.textContent + ".jpg" || "";
          const voto = v.getElementsByTagName("tipoVoto")[0]?.textContent || "";
          partidos.add(partido);
          tiposVoto.add(voto);
          return { nome, partido, foto, voto };
        }).sort((a, b) => a.nome.localeCompare(b.nome, 'pt-BR'));

        // Preencher filtros
        partyFilter.innerHTML = `<option value="">Todos os partidos</option>` +
          [...partidos].sort().map(p => `<option value="${p}">${p}</option>`).join("");
        voteFilter.innerHTML = `<option value="">Todos os votos</option>` +
          [...tiposVoto].sort().map(v => `<option value="${v}">${v}</option>`).join("");

        renderTable(rawData);
      } catch (e) {
        console.error("Erro ao carregar XML", e);
      }
    }

    searchInput.addEventListener("input", applyFilters);
    partyFilter.addEventListener("change", applyFilters);
    voteFilter.addEventListener("change", applyFilters);

    load();
  </script>

  <style>
    .not-important {
      color: rgb(153, 150, 150);
    }

    .very-important {
      color: rgb(235, 59, 59);
    }
  </style>
</body>

</html>